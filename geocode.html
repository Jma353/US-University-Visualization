<!DOCTYPE html> 
<html>
	<head>
		<style>


			html {
				font-family: Helvetica; 
			}

			svg {
				fill: #B58AA5; /* Purple fill #B58AA5 */
				stroke: #6e455f; /* black path */
			    stroke-dasharray: 2000px;
			    stroke-dashoffset: 2000px;
			    animation-name: draw;
			    animation-duration: 15s;
			    animation-fill-mode: forwards;
			    animation-iteration-count: 1;
			    animation-timing-function: linear;
				
				border:1px black;/*temporary*/
			}

			circle {
				stroke: white;
			}

			@keyframes draw {
				to {
					stroke-dashoffset: 0;
				}
			}

			/*.us-map {
				margin-left: -350px;
			}*/
			
			text {

				fill: #c4a1b7;
				stroke: #c4a1b7;
				font-size:70%;

			}
			#univName{
			    fill: #8d587a;
				stroke: #6e455f;
				stroke-width:0.3px;
				font-size:100%;
				text-anchor:middle;
			}
			#univInfo{
				stroke-width:0.3px;
				text-anchor:middle;
				font-size:65%;
			}

		</style> 
	</head> 

	<body>
	    <!-- D3 --> 
		<script type="text/javascript" src="d3/d3.min.js"></script> 
		<!-- jQuery for some animations and UI stuff --> 
		<script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
		<!-- TopoJSON for the map --> 
		<script type="text/javascript" src="http://d3js.org/topojson.v0.min.js"></script>
		<!-- k-means clustering functions we wrote --> 
		<script type="text/javascript" src="js/kcluster.js"></script> 

		<!-- Where the map goes --> 
		<div class="us-map">
         <svg width="1300" height="610"> <text x="650" y="40" id="univName">Hover over University dot on map for detailed info</text>
		 <text x="650" y="60" id="univInfo">.</text>
		 </svg>
		</div> 

		
		<!-- Start of JS --> 
		<script>


			// Map guide used: 
			// https://bl.ocks.org/mbostock/4090848

			// Assign dimensions of SVG element 
			var width = 1300; 
			var height = 610; 


			var DARK_PURPLE = "#825A6C"; 
			var LIGHT_PURPLE = "#B58AA5"
			var PINK = "#E39AB2"

			// Set the projection, based on the fact that we're using a US map 
			var projection = d3.geo.albersUsa().scale(1000).translate([width / 2, height / 2]); 

			// Set the path based on this projection 
			var path = d3.geo.path().projection(projection); 

			// SVG element 
			var svg = d3.select("svg");//(".us-map").append("svg").attr("width", width).attr("height", height); 

			// load the map JSON 
			d3.json("us-states.json", function(error, json) {

				if (error) throw error; 

				svg.selectAll("path")
					.data(json.features)
					.enter()
					.append("path")
					.attr("d", path)
					.on("mouseover", function(d) {
						d3.selectAll("path").style("fill", LIGHT_PURPLE); // Set all equal to this color 
						d3.select(this).style("fill", PINK); // Set the most recent to this color 
						d3.selectAll("circle").style("stroke", "white").style("fill", DARK_PURPLE);  // Set all previous circles to old color 
					
						// Highlight relevant circles 
						var stateName = d["properties"]["name"]; 
						var relevantCircles = d3.selectAll("circle")
												.filter(function(d) {
													var circleState = d["location_info"]["state"];
													// Check this condition 
													circleState = circleState == "District of Columbia" ? "Maryland" : circleState 
													return circleState == stateName; 
												}); 
						relevantCircles.style("stroke", LIGHT_PURPLE).style("fill", "white"); 

					}); 

			}); 

			var uniJSONs; 

			// load the universities 
			d3.json('UNIVERSITIES.json', function(error, data) {
					
				// Mapping inspiration taken from 
				// http://chimera.labs.oreilly.com/books/1230000000345/ch12.html#_adding_points

				// Radii for various situations 
				var defCircleR = 3; 
				var largeCircleR = 10; 

				// Set the data of the universities equal to the global variable tracking it 
				uniJSONs = data; 

				
				//append lines to first variable
					var allthelines=svg.selectAll("line")
					.data(data)
					.enter();
				    allthelines.append("line").attr("x1", 1200)
                    .attr("y1", 250)
                    .attr("x2", function(d) {
						var lat = d["location_info"]["lat"]; 
						var lng = d["location_info"]["lng"]; 
						return projection([lng, lat])[0]; 
					})
				    .attr("y2", function(d) {
						var lat = d["location_info"]["lat"]; 
						var lng = d["location_info"]["lng"]; 
						return projection([lng, lat])[1]; 
					})
				    .attr("stroke-width", 0.5)
				    .attr("stroke", "#ceb1c3")
				    .style("opacity", 1.0)
					.attr("class",function(d) {
						return d["school"].replace(/\s+/g, '-').replace(/[^a-zA-Z-]/g, '').toLowerCase(); 
					})
					; //make #ff4d4d on mouseover, in future 1200 , 250 will be replaced by other coordinate, and will have 3 such lines per circle

					//append lines to second variable
					/*svg.selectAll("line")
					.data(data)
					.enter()*/
				    allthelines.append("line").attr("x1", 500)
                    .attr("y1", 600)
                    .attr("x2", function(d) {
						var lat = d["location_info"]["lat"]; 
						var lng = d["location_info"]["lng"]; 
						return projection([lng, lat])[0]; 
					})
				    .attr("y2", function(d) {
						var lat = d["location_info"]["lat"]; 
						var lng = d["location_info"]["lng"]; 
						return projection([lng, lat])[1]; 
					})
				    .attr("stroke-width", 0.5)
				    .attr("stroke", "#ceb1c3")
				    .style("opacity", 1.0)
					.attr("class",function(d) {
						return d["school"].replace(/\s+/g, '-').replace(/[^a-zA-Z-]/g, '').toLowerCase(); 
					});
					
					
					svg.append("text").attr("x", 1200)
                    .attr("y", 250)
                    .text("Example: Acc Rate 0-15%");
					svg.append("text").attr("x", 500)
                    .attr("y", 600)
                    .text("var2");
					//append lines to third variable
				//circles
				svg.selectAll("circle")
					.data(data)
					.enter()
					.append("circle")
					.attr("cx", function(d) {
						var lat = d["location_info"]["lat"]; 
						var lng = d["location_info"]["lng"]; 
						return projection([lng, lat])[0]; 
					})
					.attr("cy", function(d) {
						var lat = d["location_info"]["lat"]; 
						var lng = d["location_info"]["lng"]; 
						return projection([lng, lat])[1]; 
					})
					.attr("r", defCircleR)
					.attr("data", function(d) {
						return data.indexOf(d); // Return the index of the data we care about
					})
					.style("fill", DARK_PURPLE)
					.on("mouseover", function(d) {
						d3.select(this).transition().duration(500).attr("r", largeCircleR); 
						console.log(d); 
						console.log(d["school"].replace(/\s+/g, '-').replace(/[^a-zA-Z-]/g, '').toLowerCase()); 
						d3.selectAll("."+d["school"].replace(/\s+/g, '-').replace(/[^a-zA-Z-]/g, '').toLowerCase()).style({
                           'stroke-width':'4px',
                           'stroke': '#660033'
                        });
						d3.select("#univName").text(d["school"]);
						d3.select("#univInfo").text("SAT Score: "+d["score_info"]["sat_math_low"]+" | Acceptance Rate: "+d["admissions_info"]["acceptance_rate"]+"% | Salary: $"+d["salary_info"]["mid_career_median_salary"]);
					})
					.on("mouseleave", function(d) {
						d3.select(this).transition().duration(500).attr("r", defCircleR);
						d3.selectAll("."+d["school"].replace(/\s+/g, '-').replace(/[^a-zA-Z-]/g, '').toLowerCase()).style({
                           'stroke-width':'0.5px',
                           'stroke': '#ceb1c3'
                        });
						d3.select("#univName").text("Hover over University dot on map for detailed info");
						d3.select("#univInfo").text("");
                    })

					
 

			
			});
			


	

			// Basic color fade-in on load up for map 
			$(document).ready(function() {
				// Set to 0 initially 
				$('svg').css("fill-opacity", "0"); 
				// Animate it in 
				$('svg').animate({
					"fill-opacity": "1.0"
				}, 5000, function() {}); 


			}); 


		
		</script> 

	</body> 


</html> 





